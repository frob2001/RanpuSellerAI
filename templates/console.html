<!DOCTYPE html>
<html lang="en">
<head>
    <title>Console</title>
    <script>
        // JavaScript para actualizar la cuenta regresiva dinámicamente
        function iniciarCuentaRegresiva(tiempoRestante) {
            const contador = document.getElementById("contador");
            const partes = tiempoRestante.split(":");
            let horas = parseInt(partes[0]);
            let minutos = parseInt(partes[1]);
            let segundos = parseInt(partes[2]);

            function actualizar() {
                if (horas === 0 && minutos === 0 && segundos === 0) {
                    contador.innerText = "Chats eliminados";
                    clearInterval(intervalo);
                    return;
                }
                if (segundos === 0) {
                    if (minutos === 0) {
                        horas--;
                        minutos = 59;
                    } else {
                        minutos--;
                    }
                    segundos = 59;
                } else {
                    segundos--;
                }
                contador.innerText = `${String(horas).padStart(2, '0')}:${String(minutos).padStart(2, '0')}:${String(segundos).padStart(2, '0')}`;
            }

            const intervalo = setInterval(actualizar, 1000);
        }
    </script>
</head>
<body>
    <h1>Bienvenido a la consola</h1>
    <p>Solo puedes ver esto si estás autenticado.</p>

    <h2>Tiempo restante para borrar los chats:</h2>
    <p id="contador">{{ tiempo_para_borrado }}</p>

    <script>
        // Inicializar la cuenta regresiva con el tiempo restante del servidor
        iniciarCuentaRegresiva("{{ tiempo_para_borrado }}");
    </script>

    <h2>Historial de Conversaciones</h2>
    <ul>
        {% for user_id, mensajes in historial_global.items() %}
            <li>
                <h3>Usuario ID: {{ user_id }}</h3>
                <ul>
                    {% for mensaje in mensajes %}
                        <li>
                            <strong>{{ "Usuario:" if mensaje.role == "user" else "Ranpu:" }}</strong>
                            {{ mensaje.content }}
                        </li>
                    {% endfor %}
                </ul>
            </li>
        {% endfor %}
    </ul>

    <a href="{{ url_for('logout') }}">Cerrar sesión</a>
</body>
</html>
